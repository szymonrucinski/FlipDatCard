"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = tslib_1.__importStar(require("react"));
var react_1 = require("react");
var Component_1 = require("./Component");
var loadable_1 = require("./loadable");
var useImported_1 = require("./useImported");
var utils_1 = require("./utils");
var detectBackend_1 = require("./detectBackend");
function loader(loaderFunction, baseOptions) {
    if (baseOptions === void 0) { baseOptions = {}; }
    var loadable = loadable_1.getLoadable(loaderFunction);
    var Imported = React.forwardRef(function ImportedComponentHOC(_a, ref) {
        var _b = _a.importedProps, importedProps = _b === void 0 ? {} : _b, props = tslib_1.__rest(_a, ["importedProps"]);
        var options = tslib_1.__assign({}, baseOptions, importedProps);
        return (React.createElement(Component_1.ImportedComponent, { loadable: loadable, LoadingComponent: options.LoadingComponent, ErrorComponent: options.ErrorComponent, onError: options.onError, render: options.render, async: options.async, forwardProps: props || {}, forwardRef: ref }));
    });
    Imported.preload = function () {
        loadable.load().catch(function () { return ({}); });
        return loadable.resolution;
    };
    Imported.done = loadable.resolution;
    return Imported;
}
function lazy(importer) {
    if (detectBackend_1.isBackend) {
        return loader(importer);
    }
    if (process.env.NODE_ENV !== 'production') {
        if (module.hot) {
            return loader(importer, { async: true });
        }
    }
    var topLoadable = loadable_1.getLoadable(importer);
    return function ImportedLazy(props) {
        var loadable = useImported_1.useLoadable(topLoadable).loadable;
        var Lazy = react_1.useMemo(function () { return (React.lazy(function () { return loadable.tryResolveSync(utils_1.asDefault); })); }, []);
        return (React.createElement(Lazy, tslib_1.__assign({}, props)));
    };
}
exports.lazy = lazy;
exports.default = loader;
